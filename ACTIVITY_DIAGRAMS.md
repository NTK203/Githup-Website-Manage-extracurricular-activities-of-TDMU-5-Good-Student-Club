# Sơ Đồ Activity Diagram - Hệ Thống Quản Lý Hoạt Động CLB Sinh viên 5 Tốt TDMU

## 📋 Mục Lục
1. [Đăng Nhập (Login)](#1-đăng-nhập-login)
2. [Đăng Ký Tham Gia Hoạt Động](#2-đăng-ký-tham-gia-hoạt-động)
3. [Điểm Danh (Attendance Check-in)](#3-điểm-danh-attendance-check-in)
4. [Tạo Hoạt Động (Create Activity)](#4-tạo-hoạt-động-create-activity)
5. [Duyệt Đăng Ký Tham Gia Hoạt Động](#5-duyệt-đăng-ký-tham-gia-hoạt-động)

---

## 1. Đăng Nhập (Login)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           QUẢN TRỊ VIÊN/SINH VIÊN                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ●                                                                         │
│   │                                                                         │
│   ▼                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Mở ứng dụng quản lý hoạt động CLB Sinh viên 5 Tốt TDMU        │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Hiển thị màn hình đăng nhập                                    │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                  QUẢN TRỊ VIÊN/SINH VIÊN            │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Nhập email và mật khẩu                                         │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Gửi yêu cầu xác thực đến API /api/auth/login                  │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Tìm kiếm user trong database theo email                       │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ So sánh mật khẩu với bcrypt                                   │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Kiểm tra membership status                                    │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Xác thực]                                            │
│                    │ thành công?                                           │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Tạo JWT token    │  │ Hiển thị thông   │                             │
│   │ Xác định role    │  │ báo lỗi đăng nhập│                             │
│   │ Xác định         │  │ "Email hoặc mật  │                             │
│   │ redirectUrl      │  │ khẩu không đúng" │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Trả về kết quả đăng nhập (thành công/thất bại)               │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                  QUẢN TRỊ VIÊN/SINH VIÊN            │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Đăng nhập]                                           │
│                    │ thành công?                                           │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Lưu token và     │  │ Hiển thị thông   │                             │
│   │ user info vào    │  │ báo lỗi          │                             │
│   │ localStorage     │  │ Hiển thị form    │                             │
│   │ Điều hướng đến   │  │ đăng nhập lại    │                             │
│   │ Dashboard        │  │                  │                             │
│   │ (theo role)      │  │                  │                             │
│   │                  │  │                  │                             │
│   │ - SUPER_ADMIN    │  │                  │                             │
│   │   → /admin/      │  │                  │                             │
│   │ - CLUB_LEADER    │  │                  │                             │
│   │   → /admin/      │  │                  │                             │
│   │ - CLUB_DEPUTY    │  │                  │                             │
│   │   → /officer/    │  │                  │                             │
│   │ - CLUB_MEMBER    │  │                  │                             │
│   │   → /officer/    │  │                  │                             │
│   │ - CLUB_STUDENT   │  │                  │                             │
│   │   → /student/    │  │                  │                             │
│   │ - STUDENT        │  │                  │                             │
│   │   → /student/    │  │                  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Xem Dashboard                                                  │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ⚫                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Đăng Ký Tham Gia Hoạt Động

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              SINH VIÊN                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ●                                                                         │
│   │                                                                         │
│   ▼                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Xem danh sách hoạt động                                        │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Chọn hoạt động muốn tham gia                                   │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Xem chi tiết hoạt động                                         │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Hiển thị thông tin chi tiết hoạt động                          │       │
│   │ - Tên, mô tả, ngày, địa điểm                                   │       │
│   │ - Số lượng người tham gia                                      │       │
│   │ - Trạng thái hoạt động                                         │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                      SINH VIÊN                      │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Nhấn nút "Đăng ký tham gia"                                    │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Gửi yêu cầu đăng ký đến API                                    │
│   │ POST /api/activities/[id]/register                             │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Kiểm tra xác thực (JWT token)                                  │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Tìm kiếm hoạt động trong database                              │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Hoạt động]                                          │
│                    │ tồn tại?                                              │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Kiểm tra trạng   │  │ Trả về lỗi:      │                             │
│   │ thái hoạt động   │  │ "Không tìm thấy  │                             │
│   │                  │  │ hoạt động"       │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            ▼                     │                                         │
│                    ┌─────┐       │                                         │
│                    │ [Trạng thái]│       │                                         │
│                    │ hợp lệ?     │       │                                         │
│                    │ (published/ │       │                                         │
│                    │  ongoing)   │       │                                         │
│                    └──┬──┘       │                                         │
│                       │          │                                         │
│            ┌──────────┴──────────┘                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Kiểm tra ngày    │  │ Trả về lỗi:      │                             │
│   │ hoạt động        │  │ "Hoạt động này   │                             │
│   │ (chưa kết thúc)  │  │ không còn mở     │                             │
│   │                  │  │ đăng ký"         │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            ▼                     │                                         │
│                    ┌─────┐       │                                         │
│                    │ [Ngày]      │       │                                         │
│                    │ hợp lệ?     │       │                                         │
│                    └──┬──┘       │                                         │
│                       │          │                                         │
│            ┌──────────┴──────────┘                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Kiểm tra user đã │  │ Trả về lỗi:      │                             │
│   │ đăng ký chưa?    │  │ "Hoạt động này   │                             │
│   │                  │  │ đã kết thúc"     │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            ▼                     │                                         │
│                    ┌─────┐       │                                         │
│                    │ [Đã đăng ký]│       │                                         │
│                    │ chưa?       │       │                                         │
│                    └──┬──┘       │                                         │
│                       │          │                                         │
│            ┌──────────┴──────────┘                                         │
│            │                     │                                         │
│          Chưa│                   │Rồi                                     │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Kiểm tra số      │  │ Trả về lỗi:      │                             │
│   │ lượng tối đa     │  │ "Bạn đã đăng ký  │                             │
│   │ (maxParticipants)│  │ tham gia hoạt    │                             │
│   │                  │  │ động này rồi"    │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            ▼                     │                                         │
│                    ┌─────┐       │                                         │
│                    │ [Còn chỗ?] │       │                                         │
│                    └──┬──┘       │                                         │
│                       │          │                                         │
│            ┌──────────┴──────────┘                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Thêm participant │  │ Trả về lỗi:      │                             │
│   │ vào hoạt động    │  │ "Hoạt động đã    │                             │
│   │ với status:      │  │ đầy người tham   │                             │
│   │ 'pending'        │  │ gia"             │                             │
│   │ Lưu vào database │  │                  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Trả về kết quả đăng ký                                        │       │
│   │ (thành công/thất bại)                                         │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                      SINH VIÊN                      │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Đăng ký]                                             │
│                    │ thành công?                                           │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Hiển thị thông   │  │ Hiển thị thông   │                             │
│   │ báo thành công:  │  │ báo lỗi          │                             │
│   │ "Đăng ký thành   │  │ Hiển thị form    │                             │
│   │ công! Đang chờ   │  │ đăng ký lại      │                             │
│   │ duyệt..."        │  │                  │                             │
│   │ Cập nhật UI:     │  │                  │                             │
│   │ - Trạng thái:    │  │                  │                             │
│   │   "Đang chờ duyệt"│  │                  │                             │
│   │ - Ẩn nút đăng ký │  │                  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Xem thông báo                                                  │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ⚫                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Điểm Danh (Attendance Check-in)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              SINH VIÊN                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ●                                                                         │
│   │                                                                         │
│   ▼                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Truy cập trang điểm danh của hoạt động                         │       │
│   │ /student/attendance/[activityId]                               │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Xem thông tin hoạt động và các buổi điểm danh                  │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Kiểm tra xác thực và quyền truy cập                            │       │
│   │ Kiểm tra user đã đăng ký và được duyệt chưa?                  │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Đã đăng ký]                                          │
│                    │ và được duyệt?                                        │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Hiển thị giao    │  │ Hiển thị thông   │                             │
│   │ diện điểm danh   │  │ báo: "Bạn chưa   │                             │
│   │ - Danh sách      │  │ đăng ký hoặc     │                             │
│   │   timeSlots      │  │ chưa được duyệt  │                             │
│   │ - Nút điểm danh  │  │ tham gia hoạt    │                             │
│   │   cho từng buổi  │  │ động này"        │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                      SINH VIÊN                      │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Chọn buổi muốn điểm danh                                       │
│   │ (Buổi Sáng/Buổi Chiều/Buổi Tối)                               │       │
│   │ Nhấn nút "Điểm danh"                                          │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Yêu cầu quyền truy cập vị trí (GPS)                            │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [GPS]                                                  │
│                    │ được cấp?                                              │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Lấy tọa độ GPS   │  │ Hiển thị thông   │                             │
│   │ hiện tại         │  │ báo: "Vui lòng   │                             │
│   │                  │  │ cấp quyền truy   │                             │
│   │                  │  │ cập vị trí"      │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Gửi yêu cầu điểm danh đến API                                  │
│   │ POST /api/activities/[id]/attendance                           │       │
│   │ - activityId                                                   │       │
│   │ - timeSlot                                                     │       │
│   │ - checkInType (start/end)                                      │       │
│   │ - location (lat, lng, address)                                 │       │
│   │ - photoUrl (optional)                                          │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Kiểm tra xác thực (JWT token)                                  │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Tìm kiếm hoạt động trong database                              │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Kiểm tra user đã đăng ký và được duyệt                        │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Kiểm tra vị trí điểm danh có trong phạm vi cho phép           │       │
│   │ (so sánh với locationData.radius hoặc                         │       │
│   │  multiTimeLocations[].radius)                                 │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Vị trí]                                               │
│                    │ hợp lệ?                                                │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Tìm hoặc tạo     │  │ Trả về lỗi:      │                             │
│   │ Attendance record│  │ "Vị trí điểm danh│                             │
│   │ cho user và      │  │ không hợp lệ.    │                             │
│   │ activity         │  │ Vui lòng đến đúng│                             │
│   │                  │  │ địa điểm hoạt    │                             │
│   │                  │  │ động"            │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            ▼                     │                                         │
│   ┌──────────────────┐          │                                         │
│   │ Thêm attendance  │          │                                         │
│   │ record vào       │          │                                         │
│   │ attendances[]    │          │                                         │
│   │ với status:      │          │                                         │
│   │ 'pending'        │          │                                         │
│   │ Lưu vào database │          │                                         │
│   └────────┬─────────┘          │                                         │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Trả về kết quả điểm danh                                       │       │
│   │ (thành công/thất bại)                                          │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                      SINH VIÊN                      │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Điểm danh]                                           │
│                    │ thành công?                                           │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Hiển thị thông   │  │ Hiển thị thông   │                             │
│   │ báo thành công:  │  │ báo lỗi          │                             │
│   │ "Điểm danh thành │  │ Hiển thị nút     │                             │
│   │ công! Đang chờ   │  │ điểm danh lại    │                             │
│   │ duyệt..."        │  │                  │                             │
│   │ Cập nhật UI:     │  │                  │                             │
│   │ - Trạng thái:    │  │                  │                             │
│   │   "Đã điểm danh  │  │                  │                             │
│   │   (chờ duyệt)"   │  │                  │                             │
│   │ - Hiển thị thời  │  │                  │                             │
│   │   gian điểm danh │  │                  │                             │
│   │ - Hiển thị vị trí│  │                  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Xem thông báo và cập nhật trạng thái                           │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ⚫                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Tạo Hoạt Động (Create Activity)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    QUẢN TRỊ VIÊN/CLUB LEADER/OFFICER                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ●                                                                         │
│   │                                                                         │
│   ▼                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Truy cập trang tạo hoạt động                                   │       │
│   │ /admin/activities/create-single                                │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Điền thông tin hoạt động:                                      │       │
│   │ - Tên hoạt động                                                │       │
│   │ - Mô tả                                                        │       │
│   │ - Loại (single_day/multiple_days)                              │       │
│   │ - Ngày/Thời gian                                               │       │
│   │ - Địa điểm                                                     │       │
│   │ - Số lượng tối đa                                              │       │
│   │ - Trạng thái (draft/published)                                 │       │
│   │ - Visibility (public/private)                                  │       │
│   │ - TimeSlots (nếu single_day)                                   │       │
│   │ - Schedule (nếu multiple_days)                                 │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Chọn địa điểm trên bản đồ (OpenStreetMap)                      │       │
│   │ - Chọn tọa độ GPS                                              │       │
│   │ - Chọn bán kính                                                │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Nhấn nút "Tạo hoạt động" hoặc "Lưu nháp"                      │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Validate dữ liệu đầu vào                                       │       │
│   │ - Tên (5-200 ký tự)                                            │       │
│   │ - Mô tả (10-2000 ký tự)                                        │       │
│   │ - Ngày (>= ngày hiện tại)                                      │       │
│   │ - Địa điểm (required)                                          │       │
│   │ - TimeSlots (nếu single_day)                                   │       │
│   │ - Schedule (nếu multiple_days)                                 │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Dữ liệu]                                             │
│                    │ hợp lệ?                                                │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Gửi yêu cầu đến  │  │ Hiển thị thông   │                             │
│   │ API:             │  │ báo lỗi validation│                             │
│   │ POST /api/       │  │ Hiển thị form     │                             │
│   │ activities       │  │ với các lỗi       │                             │
│   │                  │  │                   │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            ▼                     │                                         │
│   ┌──────────────────┐          │                                         │
│   │ Kiểm tra xác thực│          │                                         │
│   │ và quyền (role)  │          │                                         │
│   │                  │          │                                         │
│   └────────┬─────────┘          │                                         │
│            │                     │                                         │
│            ▼                     │                                         │
│                    ┌─────┐       │                                         │
│                    │ [Có quyền] │       │                                         │
│                    │ tạo?        │       │                                         │
│                    └──┬──┘       │                                         │
│                       │          │                                         │
│            ┌──────────┴──────────┘                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Kiểm tra         │  │ Trả về lỗi:      │                             │
│   │ responsiblePerson│  │ "Không có quyền  │                             │
│   │ role hợp lệ      │  │ tạo hoạt động"   │                             │
│   │                  │  │                  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            ▼                     │                                         │
│                    ┌─────┐       │                                         │
│                    │ [Role]      │       │                                         │
│                    │ hợp lệ?     │       │                                         │
│                    └──┬──┘       │                                         │
│                       │          │                                         │
│            ┌──────────┴──────────┘                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Tạo Activity     │  │ Trả về lỗi:      │                             │
│   │ object mới       │  │ "Người phụ trách │                             │
│   │ - Set createdBy  │  │ phải có role     │                             │
│   │ - Set updatedBy  │  │ phù hợp"         │                             │
│   │ - Set status     │  │                  │                             │
│   │ - Set timestamps │  │                  │                             │
│   │ Lưu vào database │  │                  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Trả về kết quả tạo hoạt động                                   │       │
│   │ (thành công/thất bại)                                          │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │        QUẢN TRỊ VIÊN/CLUB LEADER/OFFICER            │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Tạo hoạt động]                                       │
│                    │ thành công?                                           │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Hiển thị thông   │  │ Hiển thị thông   │                             │
│   │ báo thành công:  │  │ báo lỗi          │                             │
│   │ "Tạo hoạt động   │  │ Hiển thị form    │                             │
│   │ thành công!"     │  │ với các lỗi      │                             │
│   │ Điều hướng đến   │  │                   │                             │
│   │ trang chi tiết   │  │                   │                             │
│   │ hoặc danh sách   │  │                   │                             │
│   │ hoạt động        │  │                   │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Xem kết quả                                                    │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ⚫                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Duyệt Đăng Ký Tham Gia Hoạt Động

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    QUẢN TRỊ VIÊN/CLUB LEADER/OFFICER                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ●                                                                         │
│   │                                                                         │
│   ▼                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Truy cập trang quản lý người tham gia                          │       │
│   │ /officer/activities/[activityId]/participants                  │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Kiểm tra xác thực và quyền                                     │       │
│   │ Lấy danh sách participants của hoạt động                        │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Hiển thị danh sách người tham gia:                             │       │
│   │ - Đã duyệt (approved)                                          │       │
│   │ - Chờ duyệt (pending)                                          │       │
│   │ - Từ chối (rejected)                                           │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │        QUẢN TRỊ VIÊN/CLUB LEADER/OFFICER            │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Chọn người tham gia cần duyệt/từ chối                          │       │
│   │ Nhấn nút "Duyệt" hoặc "Từ chối"                                │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Hành động]                                           │
│                    │ Duyệt hay Từ chối?                                    │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Duyệt│                  │Từ chối                                 │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Nhập lý do (nếu  │  │ Nhập lý do từ    │                             │
│   │ cần)             │  │ chối (bắt buộc)  │                             │
│   │ Nhấn "Xác nhận"  │  │ Nhấn "Xác nhận"  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │                        HỆ THỐNG                     │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Gửi yêu cầu đến API:                                           │       │
│   │ PATCH /api/activities/[id]/participants/[participantId]        │       │
│   │ - approvalStatus: 'approved' hoặc 'rejected'                   │       │
│   │ - approvedBy/rejectedBy: user._id                              │       │
│   │ - rejectionReason (nếu từ chối)                                │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Kiểm tra xác thực và quyền                                     │       │
│   │ Tìm kiếm hoạt động và participant                              │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Tìm thấy]                                            │
│                    │ participant?                                           │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Cập nhật         │  │ Trả về lỗi:      │                             │
│   │ participant:     │  │ "Không tìm thấy  │                             │
│   │ - approvalStatus │  │ participant"     │                             │
│   │ - approvedBy/    │  │                  │                             │
│   │   rejectedBy     │  │                  │                             │
│   │ - approvedAt/    │  │                  │                             │
│   │   rejectedAt     │  │                  │                             │
│   │ - rejectionReason│  │                  │                             │
│   │ Lưu vào database │  │                  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Trả về kết quả duyệt/từ chối                                   │       │
│   │ (thành công/thất bại)                                          │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
└───────────────────────┼─────────────────────────────────────────────────────┘
                        │
                        │
┌───────────────────────┼─────────────────────────────────────────────────────┐
│                       │        QUẢN TRỊ VIÊN/CLUB LEADER/OFFICER            │
├───────────────────────┼─────────────────────────────────────────────────────┤
│                       │                                                     │
│                       ▼                                                     │
│                    ┌─────┐                                                  │
│                    │ [Duyệt/Từ chối]                                       │
│                    │ thành công?                                           │
│                    └──┬──┘                                                  │
│                       │                                                     │
│            ┌──────────┴──────────┐                                         │
│            │                     │                                         │
│          Có│                     │Không                                   │
│            │                     │                                         │
│            ▼                     ▼                                         │
│   ┌──────────────────┐  ┌──────────────────┐                             │
│   │ Hiển thị thông   │  │ Hiển thị thông   │                             │
│   │ báo thành công:  │  │ báo lỗi          │                             │
│   │ "Đã duyệt/từ chối│  │ Hiển thị danh    │                             │
│   │ thành công!"     │  │ sách lại         │                             │
│   │ Cập nhật UI:     │  │                  │                             │
│   │ - Cập nhật trạng │  │                  │                             │
│   │   thái participant│  │                  │                             │
│   │ - Cập nhật số    │  │                  │                             │
│   │   lượng đã duyệt │  │                  │                             │
│   │ - Reload danh    │  │                  │                             │
│   │   sách           │  │                  │                             │
│   └────────┬─────────┘  └────────┬─────────┘                             │
│            │                     │                                         │
│            └──────────┬──────────┘                                         │
│                       │                                                     │
│                    ═══╪═══                                                  │
│                       │                                                     │
│                       ▼                                                     │
│   ┌───────────────────────────────────────────────────────────────┐       │
│   │ Xem kết quả và danh sách cập nhật                              │       │
│   └───────────────────┬───────────────────────────────────────────┘       │
│                       │                                                     │
│                       ▼                                                     │
│                    ⚫                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 📝 Ký Hiệu Sử Dụng

- **●** : Initial Node (Điểm bắt đầu)
- **⚫** : Final Node (Điểm kết thúc)
- **┌─┐** : Activity (Hoạt động)
- **┌─┐** : Decision Node (Điểm quyết định)
- **═══** : Synchronization Bar (Thanh đồng bộ)
- **│** : Flow (Luồng)
- **▼** : Direction (Hướng)
- **Swimlanes**: Các làn bơi phân chia theo actor (Người dùng, Hệ thống)

---

## 🔍 Ghi Chú

1. **Decision Nodes**: Các điểm quyết định được đánh dấu bằng hình thoi `┌─┐` với các nhánh "Có/Không", "Thành công/Thất bại", v.v.

2. **Synchronization Bars**: Thanh đồng bộ `═══` được sử dụng để hội tụ các nhánh song song trước khi tiếp tục.

3. **Swimlanes**: Các làn bơi phân chia rõ ràng giữa các actor:
   - **Người dùng** (Sinh viên, Quản trị viên, v.v.)
   - **Hệ thống** (API, Database, v.v.)

4. **Error Handling**: Tất cả các luồng đều có xử lý lỗi và hiển thị thông báo phù hợp.

5. **Authentication**: Tất cả các API calls đều yêu cầu JWT token để xác thực.

---

**Tài liệu này cung cấp các sơ đồ Activity Diagram chi tiết cho các luồng chính trong hệ thống! 🎉**

