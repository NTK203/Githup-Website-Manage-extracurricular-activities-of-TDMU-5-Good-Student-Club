/**
 * Script to convert Roboto TTF fonts to base64 for jsPDF
 * 
 * Usage: node scripts/convert-font-to-base64.js
 * 
 * This script will:
 * 1. Read Roboto-Regular.ttf and Roboto-Bold.ttf
 * 2. Convert them to base64
 * 3. Update the font helper files
 */

const fs = require('fs');
const path = require('path');

// Paths
const robotoRegularPath = path.join(__dirname, '../src/lib/Roboto/static/Roboto-Regular.ttf');
const robotoBoldPath = path.join(__dirname, '../src/lib/Roboto/static/Roboto-Bold.ttf');
const outputNormalPath = path.join(__dirname, '../src/lib/fonts/roboto-normal.ts');
const outputBoldPath = path.join(__dirname, '../src/lib/fonts/roboto-bold.ts');

function convertFontToBase64(fontPath) {
  try {
    if (!fs.existsSync(fontPath)) {
      console.error(`Font file not found: ${fontPath}`);
      return null;
    }
    
    const fontBuffer = fs.readFileSync(fontPath);
    const base64String = fontBuffer.toString('base64');
    return base64String;
  } catch (error) {
    console.error(`Error converting font ${fontPath}:`, error);
    return null;
  }
}

function updateFontFile(outputPath, fontName, base64String, isBold = false) {
  if (!base64String) {
    console.error(`No base64 string provided for ${fontName}`);
    return;
  }

  const fileContent = `/**
 * ${fontName} font in base64 format for jsPDF
 * 
 * This file is auto-generated by scripts/convert-font-to-base64.js
 * DO NOT EDIT MANUALLY - Run the script to regenerate
 * 
 * Font source: src/lib/Roboto/static/${fontName}
 */

export const ${isBold ? 'RobotoBold' : 'RobotoNormal'} = '${base64String}';
`;

  try {
    fs.writeFileSync(outputPath, fileContent, 'utf8');
    console.log(`‚úÖ Successfully updated ${outputPath}`);
    console.log(`   Font size: ${(base64String.length / 1024).toFixed(2)} KB (base64)`);
  } catch (error) {
    console.error(`Error writing file ${outputPath}:`, error);
  }
}

// Main execution
console.log('üîÑ Converting Roboto fonts to base64...\n');

// Convert Roboto Regular
console.log('üìù Converting Roboto-Regular.ttf...');
const regularBase64 = convertFontToBase64(robotoRegularPath);
if (regularBase64) {
  updateFontFile(outputNormalPath, 'Roboto-Regular.ttf', regularBase64, false);
} else {
  console.error('‚ùå Failed to convert Roboto-Regular.ttf');
}

console.log('');

// Convert Roboto Bold
console.log('üìù Converting Roboto-Bold.ttf...');
const boldBase64 = convertFontToBase64(robotoBoldPath);
if (boldBase64) {
  updateFontFile(outputBoldPath, 'Roboto-Bold.ttf', boldBase64, true);
} else {
  console.error('‚ùå Failed to convert Roboto-Bold.ttf');
}

console.log('\n‚ú® Font conversion complete!');
console.log('üìå Next steps:');
console.log('   1. Restart your development server');
console.log('   2. Try exporting a PDF - Vietnamese fonts should now work correctly!');
